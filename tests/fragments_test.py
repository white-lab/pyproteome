from unittest import TestCase

from pycamv import fragments


class FragmentIonsTest(TestCase):
    def test_fragment_ions(self):
        test_peptides = {
            (
                (
                    ("N-term", ("TMT6plex",)),
                    ("S", ()),
                    ("V", ()),
                    ("Y", ("Phospho",)),
                    ("T", ()),
                    ("E", ()),
                    ("I", ()),
                    ("K", ("TMT6plex",)),
                    ("C-term", ()),
                ),
                2,
            ): {
                "a_{1}^{+}": 289.21,
                "a_{2}^{+}": 388.28,
                "b_{1}^{+}": 317.20,
                "b_{2}^{+}": 416.27,
                "b_{3}^{+}": 659.30,
                "b_{4}^{+}": 760.35,
                "b_{5}^{+}": 889.39,
                "b_{6}^{+}": 1002.47,
                "y_{1}^{+}": 376.28,
                "y_{2}^{+}": 489.36,
                "y_{3}^{+}": 640.39,
                "y_{4}^{+}": 719.45,
                "y_{5}^{+}": 962.48,
                "y_{6}^{+}": 1061.55,
                "y_{7}^{+}": 1148.58,
                "pY": 216.04,
                "126": 126.13,
                "127": 127.13,
                "128": 128.13,
                "129": 129.13,
                "130": 130.14,
                "131": 131.14,
                "MH^{+2}": 689.37,
                "MH^{+2}-HPO_4": 649.39,
                "MH^{+2}-H_2O": 680.37,
                "MH^{+2}-H_2O-HPO_3": 640.39,
            },
            (
                (
                    ("N-term", ("TMT6plex",)),
                    ("I", ()),
                    ("G", ()),
                    ("E", ()),
                    ("G", ()),
                    ("T", ()),
                    ("Y", ("Phospho",)),
                    ("G", ()),
                    ("V", ()),
                    ("V", ()),
                    ("Y", ()),
                    ("K", ("TMT6plex",)),
                    ("C-term", ()),
                ),
                3,
            ): {
                "a_{1}^{+}": 315.26,
                "a_{3}^{+}": 501.32,
                "a_{5}^{+}": 659.39,
                "a_{7}^{+}": 959.44,
                "b_{1}^{+}": 343.25,
                "b_{2}^{+}": 400.28,
                "b_{3}^{+}": 529.32,
                "b_{4}^{+}": 586.34,
                "b_{5}^{+}": 687.39,
                "b_{5}^{+}-H_2O": 669.38,
                "b_{6}^{+}": 930.42,
                "b_{7}^{+}": 987.44,
                "b_{8}^{+}": 1086.51,
                "y_{1}^{+}": 376.28,
                "y_{2}^{+}": 539.34,
                "y_{3}^{+}": 638.41,
                "y_{4}^{+}": 737.48,
                "y_{5}^{+}": 794.50,
                "pY": 216.04,
                "126": 126.13,
                "127": 127.13,
                "128": 128.13,
                "129": 129.13,
                "130": 130.14,
                "131": 131.14,
                "MH^{+3}": 575.31,
                "MH^{+3}-HPO_3": 548.66,
            }
        }

        for (pep_seq, charge), hits in test_peptides.items():
            frag_ions = fragments.fragment_ions(
                pep_seq, charge,
            )

            for name, mz in hits.items():
                self.assertIn(name, frag_ions)
                self.assertLess(abs(frag_ions[name] - mz), 0.01)
